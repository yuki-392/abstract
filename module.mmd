flowchart LR

    subgraph RightSide[ ]
        direction TB  %% ここで縦方向に
        %% ドライバ役システム（上）
        subgraph DriverSystem[コード生成・修正システム]
            EDB[誤り制御情報]
            P1([ソースコード生成])
            FSpec[関数仕様セット]
            Code[ソースコード]
            P3([ソースコード修正])
        end

        %% 評価システム（下）
        subgraph EvalSystem[評価システム]
            P2([修正指示評価])
        end
    end

    %% 学習者（上）
    subgraph User[学習者（ナビゲータ役）]
        direction TB
        Spec[関数仕様]
        U[修正指示]
        R[評価結果]
        ReCheck([修正の再検討])
        E[修正後ソースコード]
    end

    %% データフロー
    Spec --> P1
    EDB --> P1
    P1 --> Code & FSpec
    FSpec --> P3
    P3 <--> Code
    U --> P3
    U & FSpec & Code --> P2
    P3 --> E
    P2 --> R
    R --> ReCheck --> U

    %% 背景色スタイル定義
    style EvalSystem fill:#ddd,stroke:#333,stroke-width:2px
    style DriverSystem fill:#ddd,stroke:#333,stroke-width:2px
    style User fill:#cfc,stroke:#333,stroke-width:2px

    %% ノードの色（背景白・文字黒）
    style P1 fill:#fff,stroke:#000,color:#000
    style P2 fill:#fff,stroke:#000,color:#000
    style P3 fill:#fff,stroke:#000,color:#000
    style Code fill:#fff,stroke:#000,color:#000
    style FSpec fill:#fff,stroke:#000,color:#000
    style EDB fill:#fff,stroke:#000,color:#000
    style Spec fill:#fff,stroke:#000,color:#000
    style U fill:#fff,stroke:#000,color:#000
    style R fill:#fff,stroke:#000,color:#000
    style ReCheck fill:#fff,stroke:#000,color:#000
    style E fill:#fff,stroke:#000,color:#000
